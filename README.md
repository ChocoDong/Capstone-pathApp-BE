# PathApp Backend

> **대구가톨릭대학교(DCU) 캡스톤 디자인 프로젝트**  
> 앙상블 LLM 기반 경로 최적화 관광지 추천 시스템 백엔드

---

## 📖 프로젝트 개요

PathApp 백엔드는 **앙상블 LLM 추론 엔진**과 **RESTful API 서버**를 통합하여 모바일 클라이언트에 지능형 관광지 추천 서비스를 제공합니다. 두 개의 독립적인 LLM을 결합하여 더 정확하고 다양한 추천을 생성하며, 경로 최적화 알고리즘을 적용하여 실용적인 여행 계획을 지원합니다.

본 저장소는 **서버 인프라, API 엔드포인트, LLM 추론 로직, 데이터베이스 관리**를 담당합니다.

---

## 🏗️ 시스템 아키텍처

```
┌───────────────────────────────────────────────────────────────┐
│                      Mobile Frontend                          │
│                            ↓↑                                 │
├───────────────────────────────────────────────────────────────┤
│                        REST API                               │
│                            ↓↑                                 │
├───────────────────────────────────────────────────────────────┤
│                      Backend Server                           │
│                       (Express.js)                            │
│   ┌───────────────────────────────────────────────────────┐   │
│   │  API Routes                                           │   │
│   │  • /api/recommendations - 추천 요청                     │   │
│   │  • /api/favorites - 즐겨찾기                            │   │
│   │  • /api/reviews - 리뷰 & 별점                           │   │
│   └───────────────────────────────────────────────────────┘   │
│                            ↓↑                                 │
│   ┌───────────────────────────────────────────────────────┐   │
│   │  MySQL Database                                       │   │
│   │  • 사용자 정보                                           │   │
│   │  • 즐겨찾기                                              │   │
│   │  • 리뷰 & 별점                                           │   │
│   │  • 테마별 추천 캐시 (자연, 역사, 문화, 맛집 등)                 │   │
│   └───────────────────────────────────────────────────────┘   │
│                            ↓↑                                 │
│   ┌───────────────────────────────────────────────────────┐   │
│   │  추천 생성 로직                                           │   │
│   │  ┌─────────────────────────────────────────────────┐  │   │
│   │  │  1. DB 우선 탐색 (캐시 확인)                         │  │   │
│   │  │     ↓ (캐시 미스시)                                │  │   │
│   │  │  2. LLM 앙상블 호출                                │  │   │
│   │  │     ↓                                           │  │   │
│   │  │  3. 결과를 DB에 테마별 저장                           │  │  │
│   │  └─────────────────────────────────────────────────┘  │   │
│   └───────────────────────────────────────────────────────┘   │
│                            ↓↑                                 │
├───────────────────────────────────────────────────────────────┤
│                   Ensemble LLM Engine                          │
│   ┌───────────────────────────────────────────────────────┐   │
│   │          LLM Model 1          LLM Model 2             │   │
│   │               ↓                    ↓                  │   │
│   │               └────────┬───────────┘                  │   │
│   │                   Ensemble Logic                      │   │
│   │                        ↓                              │   │
│   │               경로 최적화 알고리즘                         │   │
│   │                        ↓                              │   │
│   │             맞춤형 관광지 추천 결과                         │   │
│   └───────────────────────────────────────────────────────┘   │
└───────────────────────────────────────────────────────────────┘
```

---

## ✨ 주요 기능

### 🤖 앙상블 LLM 추론
- **이중 모델 통합**: 두 개의 독립적인 LLM을 결합하여 추천 생성
- **앙상블 로직**: 모델 출력을 가중 평균 또는 투표 방식으로 결합
- **DB 우선 탐색**: LLM 무분별한 호출 방지를 위한 캐시 시스템

### 💾 데이터베이스 관리 (MySQL)
- **사용자 관리**: 회원 정보, 선호도 저장
- **즐겨찾기**: 사용자별 저장된 장소 관리
- **리뷰 & 별점**: 5점 만점 평점 및 사용자 후기 저장
- **테마별 추천 캐시**: 자연, 역사, 문화, 맛집 등 카테고리별 저장
- **자동 데이터 최신화**: 약 1년 주기로 오래된 캐시 데이터 삭제

### 🔍 추천 최적화 전략
- **DB 우선 탐색**: 동일하거나 유사한 요청은 캐시된 결과 반환
- **LLM 호출 최소화**: API 비용 절감 및 응답 속도 개선
- **테마별 분류**: 사용자 선호도 기반 효율적인 캐시 관리

### 📍 경로 최적화
- **지리적 분석**: 출발지-목적지 간 경로 상의 관광지 필터링
- **거리 계산**: 위도/경도 기반 거리 및 이동 시간 추정
- **우선순위 정렬**: 사용자 선호도와 접근성을 고려한 순위화

---

## 🛠 기술 스택

### 서버
- **Node.js** - JavaScript 런타임 환경
- **Express.js** - 웹 애플리케이션 프레임워크
- **JavaScript** - 주요 개발 언어

### 데이터베이스
- **MySQL** - 관계형 데이터베이스
  - 사용자 정보 관리
  - 즐겨찾기 & 리뷰 저장
  - 테마별 추천 캐싱

### AI/ML
- **LLM API 통합** - 외부 LLM 모델 연동
- **앙상블 알고리즘** - 다중 모델 결과 통합

---

## 🚀 실행 방법

```bash
# 저장소 클론
git clone https://github.com/ChocoDong/Capstone-pathApp-BE.git
cd Capstone-pathApp-BE

# 의존성 설치
npm install

# 서버 시작
npm start
```

---

## 📂 프로젝트 구조

```
Capstone-pathApp-BE/
│
├── bin/                    # 서버 시작 스크립트
├── routes/                 # API 라우트
├── middleware/             # Express 미들웨어
├── utils/                  # 유틸리티 함수
├── database/               # 데이터베이스 설정
├── views/                  # 뷰 템플릿
├── public/                 # 정적 파일
├── app.js                  # Express 앱 설정
└── package.json            # 프로젝트 의존성
```

---

## 🔌 API 엔드포인트

### 추천
```
POST /api/recommendations   # AI 추천 생성
```

**요청 예시:**
```json
{
  "startLocation": {
    "latitude": 35.8714,
    "longitude": 128.6014
  },
  "endLocation": {
    "latitude": 35.1796,
    "longitude": 129.0756
  },
  "preferences": {
    "theme": "자연",
    "interests": ["산", "계곡"]
  }
}
```

**응답 예시:**
```json
{
  "source": "cache",
  "recommendations": [
    {
      "id": "place_001",
      "name": "해인사",
      "description": "유네스코 세계문화유산",
      "location": {
        "latitude": 35.8014,
        "longitude": 128.0956
      },
      "distance": 12.5,
      "theme": "역사"
    }
  ]
}
```

### 즐겨찾기
```
GET    /api/favorites         # 내 즐겨찾기 목록
POST   /api/favorites         # 즐겨찾기 추가
DELETE /api/favorites/:id     # 즐겨찾기 삭제
```

### 리뷰
```
GET    /api/reviews/place/:placeId  # 특정 장소의 리뷰
POST   /api/reviews                 # 리뷰 작성
PUT    /api/reviews/:id             # 리뷰 수정
DELETE /api/reviews/:id             # 리뷰 삭제
```

---

## 🧠 추천 생성 프로세스

### DB 우선 탐색 전략
```
1. 사용자 추천 요청 수신
   ↓
2. 요청 데이터 분석 (출발지, 목적지, 테마)
   ↓
3. MySQL 캐시 테이블 검색
   • 동일한 경로 & 테마 조회
   • 유사한 요청 패턴 검색
   ↓
4-A. 캐시 히트 (Cache Hit)
   → DB에서 즉시 결과 반환
   → LLM 호출 없이 빠른 응답
   ↓
4-B. 캐시 미스 (Cache Miss)
   → LLM 앙상블 추론 실행
   → 생성된 결과를 DB에 저장
   → 응답 반환
   ↓
5. 결과 반환 (source: "cache" 또는 "llm")
```

### 앙상블 LLM 추론 (캐시 미스시)
```
1. LLM Model 1 호출 → 추천 결과 A
2. LLM Model 2 호출 → 추천 결과 B
3. 앙상블 알고리즘 적용
   • 교집합 우선 선택
   • 신뢰도 점수 기반 가중 평균
4. 경로 최적화 필터링
5. 결과를 MySQL에 테마별 저장
6. 최종 추천 반환
```

### 데이터 최신화 전략
- **주기적 정리**: 약 1년 주기로 오래된 캐시 데이터 자동 삭제
- **테마별 관리**: 자연, 역사, 문화, 맛집 등 카테고리별 캐시
- **인기도 기반**: 자주 조회되는 데이터는 유지 기간 연장 가능

---

## 🏆 수상 내역

**학술대회 논문 수상** 🎓
- 앙상블 LLM 기반 여행 추천 시스템의 혁신성 인정
- DB 캐싱을 통한 효율적인 추천 시스템 설계 평가

📄 **논문 상세 내용**: [학술대회 논문 보기](https://www.notion.so/2025-2f6d0f73735280f6acfee72056c42735)

---

## 💡 기술적 특징

### 성능 최적화
- **DB 우선 탐색**: LLM API 호출 비용 최소화
- **테마별 캐싱**: 유사 요청 빠른 응답
- **비동기 처리**: 논블로킹 I/O

### 데이터 관리
- **MySQL 기반 저장**: 사용자 데이터 및 추천 캐시
- **테마별 분류**: 효율적인 캐시 검색
- **자동 최신화**: 주기적 오래된 데이터 삭제

---

## 📈 향후 개발 계획

- ✅ **DB 우선 탐색 구현 완료**
- 🔄 **캐시 최적화 알고리즘 개선 중**
- 📅 **계획**: 사용자 피드백 기반 추천 정확도 향상
- 📅 **계획**: 실시간 인기 관광지 트렌드 반영

---

## 🤝 프로젝트 정보

**대학**: 대구가톨릭대학교(DCU)  
**프로젝트 유형**: 캡스톤 디자인  
**개발자**: ChocoDong  
**백엔드 저장소**: [GitHub](https://github.com/ChocoDong/Capstone-pathApp-BE)

---

## 🔗 관련 저장소

- **프론트엔드 저장소**: [Capstone-pathApp-FE](https://github.com/ChocoDong/Capstone-pathApp-FE)  
  *(React Native 모바일 클라이언트)*

---
